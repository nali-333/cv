<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV - Compétences Animées au Scroll</title>
    
    <!-- Tailwind CSS pour le style moderne et responsive -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Anime.js CDN pour les animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Configuration Firebase (obligatoire pour l'environnement d'exécution) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let app, db, auth;
        
        try {
            if (Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            }
        } catch (error) {
            console.error("Firebase initialization failed:", error);
        }

        // Fonction pour démarrer l'initialisation après l'authentification
        const startApp = async () => {
            let userId = null;
            
            if (auth) {
                try {
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                    } else {
                        await signInAnonymously(auth);
                    }
                    userId = auth.currentUser?.uid || 'anonymous-user';
                    
                    const initDocRef = doc(db, 'artifacts', appId, 'users', userId, 'config', 'init');
                    
                    const unsubscribe = onSnapshot(initDocRef, (docSnapshot) => {
                        if (window.initScrollTrigger) {
                            window.initScrollTrigger(); // Démarre l'Observer après initialisation
                        }
                        unsubscribe(); 
                    }, (error) => {
                        console.error("Error subscribing to init doc:", error);
                        if (window.initScrollTrigger) {
                            window.initScrollTrigger();
                        }
                    });

                } catch (error) {
                    console.error("Firebase Authentication failed:", error);
                    if (window.initScrollTrigger) {
                        window.initScrollTrigger();
                    }
                }
            } else {
                if (window.initScrollTrigger) {
                    window.initScrollTrigger();
                }
            }
        };

        window.addEventListener('load', startApp);
    </script>

    <style>
        /* Importation de police et styles de base */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background: #1a1a1a; /* Fond noir */
            color: #f0f0f0; /* Texte clair */
            /* Ajout pour une meilleure perspective 3D */
            perspective: 1000px; 
        }

        h1 {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 30px;
            color: #ffffff;
            border-bottom: 2px solid #3c82f6;
            padding-bottom: 10px;
        }

        /* État initial de la section pour l'effet de pop/bascule */
        #skills-section {
            transform: scale(0.95) rotateX(10deg);
            opacity: 0;
            transform-origin: top center; /* Rotation depuis le haut */
        }

        .skill-item {
            margin-bottom: 25px;
            /* Masque initialement les éléments pour l'effet d'apparition */
            opacity: 0; 
        }

        .skill-bar-container {
            background: #333333;
            height: 14px;
            border-radius: 7px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .skill-bar-fill {
            height: 100%;
            width: 0%;
            background: #3b82f6; /* Bleu solide rétabli */
            border-radius: 7px;
        }
        
        .skill-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        /* Styles pour le texte splité par lettre */
        .skill-label-text span {
            display: inline-block; /* Nécessaire pour l'animation individuelle des lettres */
            opacity: 0; /* Masqué initialement pour l'animation d'apparition */
        }

        .skill-counter {
            font-weight: 800;
            color: #60a5fa;
            min-width: 3.5rem;
            text-align: right;
            font-size: 0.95rem;
            opacity: 0; /* Masqué initialement */
        }

        /* Classe pour le remplissage forcé */
        .h-filler {
            /* Hauteur de 100% de la fenêtre visible (viewport height) */
            height: 100vh; 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            color: #4b5563; /* Texte gris discret */
            font-style: italic;
            border-bottom: 1px dashed #4b5563;
        }
    </style>
</head>
<body>

    <main class="max-w-xl mx-auto p-4 md:p-8">

        <!-- ZONE DE REMPLISSAGE POUR FORCER LE SCROLL -->
        <div class="h-filler">
            Faites défiler vers le bas pour voir les compétences s'animer...
        </div>

        <!-- SECTION DES COMPÉTENCES (CIBLE DE L'OBSERVER) -->
        <section id="skills-section">
            <h1>Mes Soft Skills et Approches</h1>

            <div class="space-y-6">
                
                <div class="skill-item" data-skill-level="85">
                    <div class="skill-header">
                        <span class="skill-label-text">Travail d'équipe</span>
                        <span class="skill-counter" data-counter="0">0%</span>
                    </div>
                    <div class="skill-bar-container">
                        <div class="skill-bar-fill" data-skill-fill></div>
                    </div>
                </div>

                <div class="skill-item" data-skill-level="80">
                    <div class="skill-header">
                        <span class="skill-label-text">Autonomie</span>
                        <span class="skill-counter" data-counter="0">0%</span>
                    </div>
                    <div class="skill-bar-container">
                        <div class="skill-bar-fill" data-skill-fill></div>
                    </div>
                </div>

                <div class="skill-item" data-skill-level="90">
                    <div class="skill-header">
                        <span class="skill-label-text">Persévérance</span>
                        <span class="skill-counter" data-counter="0">0%</span>
                    </div>
                    <div class="skill-bar-container">
                        <div class="skill-bar-fill" data-skill-fill></div>
                    </div>
                </div>

                <div class="skill-item" data-skill-level="75">
                    <div class="skill-header">
                        <span class="skill-label-text">Esprit critique</span>
                        <span class="skill-counter" data-counter="0">0%</span>
                    </div>
                    <div class="skill-bar-container">
                        <div class="skill-bar-fill" data-skill-fill></div>
                    </div>
                </div>

                <div class="skill-item" data-skill-level="70">
                    <div class="skill-header">
                        <span class="skill-label-text">Culture numérique & médias</span>
                        <span class="skill-counter" data-counter="0">0%</span>
                    </div>
                    <div class="skill-bar-container">
                        <div class="skill-bar-fill" data-skill-fill></div>
                    </div>
                </div>
                
            </div>
            
        </section>

    </main>

    <script>
        // Utilitaire pour splitter le texte en spans (simule SplitText)
        function splitTextIntoSpans() {
            document.querySelectorAll('.skill-label-text').forEach(element => {
                const text = element.textContent;
                element.textContent = ''; // Vide le contenu original
                
                text.split('').forEach(char => {
                    const span = document.createElement('span');
                    span.textContent = char;
                    if (char === ' ') {
                        span.style.width = '0.5em'; // Espace pour les mots
                    }
                    element.appendChild(span);
                });
            });
        }

        // 1. Animation de la section complète (Pop en 3D)
        window.startSectionPopAnimation = function() {
            anime({
                targets: '#skills-section',
                scale: [0.95, 1],       // Mise à l'échelle de 95% à 100%
                rotateX: [10, 0],       // Bascule de 10 degrés à 0
                opacity: [0, 1],        // Apparaît
                easing: 'easeOutQuad',
                duration: 800,
            });
        };

        // 2. Animation du titre (Pulsation constante)
        window.startTitlePulseAnimation = function() {
            anime({
                targets: '#skills-section h1',
                scale: [1, 1.01],
                color: ['#ffffff', '#60a5fa'], // Pulsation de couleur
                easing: 'easeInOutSine',
                duration: 2000,
                direction: 'alternate',
                loop: true
            });
        };

        // 3. Animation des barres et des compteurs
        window.startSkillAnimations = function() {
            const skillItems = document.querySelectorAll('.skill-item');
            
            // Fait apparaître les blocs de compétence individuelle
            anime({
                targets: skillItems,
                opacity: 1, 
                easing: 'linear',
                duration: 500
            });

            const tl = anime.timeline({
                easing: 'easeInOutExpo',
                duration: 1500,
                delay: anime.stagger(200), // Décalage entre chaque barre
                autoplay: true 
            });

            skillItems.forEach((item, index) => {
                const level = item.getAttribute('data-skill-level'); 
                const fillElement = item.querySelector('[data-skill-fill]'); 
                const counterElement = item.querySelector('[data-counter]'); 
                
                // Animation de la largeur de la barre (timeline + stagger)
                tl.add({
                    targets: fillElement,
                    width: `${level}%`,
                }, 0); 
                
                // Animation du compteur numérique (timeline + stagger)
                tl.add({
                    targets: counterElement,
                    opacity: 1, // Fait apparaître le compteur
                }, index * 200);

                tl.add({
                    targets: { p: 0 },
                    p: level,
                    round: 1,
                    duration: 1500,
                    easing: 'easeInOutExpo',
                    update: function(anim) {
                        counterElement.textContent = Math.round(anim.animations[0].currentValue) + '%';
                    }
                }, index * 200);
            });
        };

        // 4. Animation du texte (Split Text)
        window.startSplitTextAnimation = function() {
            const spans = document.querySelectorAll('.skill-label-text span');

            anime({
                targets: spans,
                translateY: [10, 0], // Remonte de 10px à 0
                opacity: [0, 1],    // Apparaît
                easing: 'easeOutQuad',
                duration: 800,
                delay: anime.stagger(20, {start: 300}), // Décalage très court entre chaque lettre
            });
        };


        // 5. Déclenchement au scroll (Intersection Observer)
        window.initScrollTrigger = function() {
            // Prépare le texte avant l'observation
            splitTextIntoSpans(); 

            const target = document.getElementById('skills-section');
            if (!target) return;

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // L'élément est visible : on lance toutes les animations
                        window.startSectionPopAnimation(); // Animation de la section
                        window.startTitlePulseAnimation(); // Animation du titre
                        window.startSkillAnimations();     // Animation des barres et compteurs
                        window.startSplitTextAnimation();  // Animation du texte
                        
                        // On arrête l'observation
                        observer.unobserve(entry.target);
                    }
                });
            }, {
                threshold: 0.1 
            });

            observer.observe(target);
        };
        
        // La fonction window.initScrollTrigger() est appelée après 
        // l'initialisation de Firebase.
    </script>
</body>
</html>
